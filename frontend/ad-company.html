<!-- frontend/ad-company.html -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bedrijf aanmelden ‚Äì Irisje.nl</title>
  <meta name="description" content="Voeg eenvoudig je bedrijf toe aan Irisje.nl en ontvang directe aanvragen van klanten in jouw regio." />
  <meta name="theme-color" content="#4F46E5" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="stylesheet" href="style.css?v=20251206" />
</head>

<body class="irisje-body flex flex-col min-h-screen">

<header class="irisje-header sticky top-0 z-40">
  <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
    <a href="index.html" class="flex items-center space-x-2">
      <span class="inline-flex items-center justify-center w-9 h-9 rounded-2xl bg-white/90 text-indigo-700 text-sm font-bold">I</span>
      <div class="flex flex-col leading-tight">
        <span class="font-semibold text-sm">Irisje.nl</span>
        <span class="text-[11px] text-slate-500">Bedrijf aanmelden</span>
      </div>
    </a>
    <a href="login.html" class="btn-ghost btn-xs">Inloggen</a>
  </div>
</header>

<main class="page-shell">
  <section class="surface-card p-6 w-full max-w-xl mx-auto">
    <h1 class="text-2xl font-bold text-indigo-700 mb-4 text-center">üè¢ Nieuw bedrijf aanmelden</h1>

    <form id="companyForm" class="space-y-5" novalidate>

      <div>
        <label class="block text-sm font-medium mb-1">Bedrijfsnaam</label>
        <input id="name" required class="w-full border rounded-xl p-3 text-sm" />
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Categorie</label>
        <select id="category" required class="w-full border rounded-xl p-3 text-sm">
          <option value="">‚Äî Kies een categorie ‚Äî</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Specialismes</label>
        <div id="specialtiesContainer" class="space-y-2 text-sm text-gray-700">
          <p class="text-gray-400 text-xs">Kies eerst een categorie</p>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Plaats</label>
        <input id="location" required class="w-full border rounded-xl p-3 text-sm" />
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Beschrijving</label>
        <textarea id="description" rows="4" required class="w-full border rounded-xl p-3 text-sm"></textarea>
      </div>

      <button type="submit" class="w-full btn-primary py-3 text-sm font-semibold rounded-xl">
        Bedrijf toevoegen
      </button>

      <p id="message" class="text-center text-sm mt-3 min-h-[1.25rem]"></p>
    </form>
  </section>
</main>

<script>
const API_BASE = "https://irisje-backend.onrender.com/api";

/* Centrale categorie-config */
const CATEGORIES = {
  "Juridisch": [
    "Arbeidsrecht",
    "Ontslag (VSO)",
    "Bestuursrecht",
    "Handhaving & BOA-zaken",
    "Vergunningen & handhaving",
    "Huurrecht",
    "Aansprakelijkheidsrecht",
    "Mediation",
    "Overheidsrecht (Awb/Woo)"
  ]
};

/* Elementen expliciet ophalen */
const form = document.getElementById("companyForm");
const nameInput = document.getElementById("name");
const categorySelect = document.getElementById("category");
const locationInput = document.getElementById("location");
const descriptionInput = document.getElementById("description");
const specialtiesContainer = document.getElementById("specialtiesContainer");
const messageEl = document.getElementById("message");

/* Veilig lezen helper */
function readValue(el) {
  return String(el && el.value ? el.value : "").trim();
}

/* Categorie√´n vullen */
Object.keys(CATEGORIES).forEach(cat => {
  const opt = document.createElement("option");
  opt.value = cat;
  opt.textContent = cat;
  categorySelect.appendChild(opt);
});

/* Specialismes dynamisch */
categorySelect.addEventListener("change", () => {
  specialtiesContainer.innerHTML = "";
  const list = CATEGORIES[categorySelect.value] || [];
  if (!list.length) {
    specialtiesContainer.innerHTML = "<p class='text-gray-400 text-xs'>Geen specialismes</p>";
    return;
  }
  list.forEach(spec => {
    const label = document.createElement("label");
    label.className = "flex items-center gap-2";
    label.innerHTML = `<input type="checkbox" value="${spec}"> ${spec}`;
    specialtiesContainer.appendChild(label);
  });
});

/* Submit */
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = readValue(nameInput);
  const category = readValue(categorySelect);
  const city = readValue(locationInput);
  const description = readValue(descriptionInput);

  if (!name || !category || !city || !description) {
    messageEl.textContent = "‚ùå Vul alle verplichte velden in.";
    messageEl.className = "text-red-600 text-center text-sm";
    return;
  }

  const specialties = Array.from(
    specialtiesContainer.querySelectorAll("input:checked")
  ).map(cb => cb.value);

  const payload = {
    name,
    categories: [category],
    specialties,
    city,
    description
  };

  try {
    messageEl.textContent = "‚è≥ Bezig met toevoegen...";
    const res = await fetch(`${API_BASE}/companies`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Fout bij toevoegen");

    messageEl.textContent = "‚úÖ Bedrijf succesvol toegevoegd!";
    messageEl.className = "text-green-600 text-center text-sm";
    form.reset();
    specialtiesContainer.innerHTML = "<p class='text-gray-400 text-xs'>Kies eerst een categorie</p>";
  } catch (err) {
    messageEl.textContent = "‚ùå " + err.message;
    messageEl.className = "text-red-600 text-center text-sm";
  }
});
</script>
</body>
</html>
