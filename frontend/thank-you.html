<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Aanvraag verstuurd – Irisje.nl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body class="irisje-body">

<header class="site-header">
  <div class="container">
    <a href="/" class="logo">Irisje.nl</a>
  </div>
</header>

<main class="container">
  <div class="card-premium">
    <h1 class="card-title">Aanvraag verstuurd</h1>

    <div id="successMessage" style="display:none;">
      <p class="card-subtitle">
        Je aanvraag is succesvol verstuurd naar de geselecteerde bedrijven.
      </p>

      <p class="hint">
        Bedrijven nemen rechtstreeks contact met je op via e-mail of telefoon.
        Controleer ook even je spamfolder als je nog niets hoort.
      </p>

      <div id="sentCompaniesBox" class="selected-box" style="display:none;">
        <div class="selected-title">Naar deze bedrijven is je aanvraag verstuurd</div>
        <ul id="sentCompaniesList" class="selected-list"></ul>
      </div>

      <div class="actions">
        <a href="/" class="btn-primary">Terug naar de startpagina</a>
      </div>
    </div>

    <div id="noContextMessage" style="display:none;">
      <p class="hint">
        We konden geen recente aanvraag vinden. Probeer het opnieuw vanaf de beginpagina.
      </p>
      <div class="actions">
        <a href="/" class="btn-primary">Naar de startpagina</a>
      </div>
    </div>
  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <p>© Irisje.nl</p>
  </div>
</footer>

<style>
  /* ---------- Premium polish (lokale scope) ---------- */
  .card-premium{
    max-width:560px;
    margin:72px auto 0;
    background:#fff;
    padding:48px;
    border-radius:14px;
    box-shadow:0 22px 50px rgba(0,0,0,.12);
  }
  .card-title{margin-bottom:10px;}
  .card-subtitle{margin-bottom:18px;color:#444;}
  .hint{margin-bottom:22px;color:#666;}

  .actions{margin-top:28px;}

  .selected-box{
    margin-top:22px;
    padding:16px 18px;
    border-radius:12px;
    background:#fafafa;
    border:1px solid #e6e6e6;
  }
  .selected-title{font-weight:600;margin-bottom:8px;}
  .selected-list{margin:0;padding-left:18px;}
</style>

<script>
  function safeJsonParse(raw){ try{ return JSON.parse(raw); }catch(e){ return null; } }

  const wasRequestSent = sessionStorage.getItem("requestSent");
  const successEl = document.getElementById("successMessage");
  const noCtxEl = document.getElementById("noContextMessage");

  if (wasRequestSent === "1") {
    successEl.style.display = "block";
    sessionStorage.removeItem("requestSent");

    // 1) Primair: sentCompanies (komt uit request-send)
    const sentCompaniesParsed = safeJsonParse(sessionStorage.getItem("sentCompanies"));
    let sentCompanies = Array.isArray(sentCompaniesParsed) ? sentCompaniesParsed : [];

    // 2) Fallback: selectedCompaniesSummary (voor safety / no-regressie)
    if (!sentCompanies.length) {
      const fallbackParsed = safeJsonParse(sessionStorage.getItem("selectedCompaniesSummary"));
      sentCompanies = Array.isArray(fallbackParsed) ? fallbackParsed : [];
    }

    const boxEl = document.getElementById("sentCompaniesBox");
    const listEl = document.getElementById("sentCompaniesList");

    if (boxEl && listEl && sentCompanies.length) {
      boxEl.style.display = "block";
      listEl.innerHTML = "";
      sentCompanies.forEach(c => {
        const li = document.createElement("li");
        li.textContent = (c?.name || "Onbekend bedrijf") + (c?.city ? ` (${c.city})` : "");
        listEl.appendChild(li);
      });
    }

    sessionStorage.removeItem("sentCompanies");
  } else {
    noCtxEl.style.display = "block";
  }
</script>

</body>
</html>
