<!-- frontend/register.html -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registreren – Irisje.nl</title>
  <link rel="stylesheet" href="/style.css?v=20260108">
</head>

<body class="irisje-body">

<header class="irisje-header">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="/" class="flex items-center space-x-2">
      <span class="inline-flex items-center justify-center w-9 h-9 rounded-2xl bg-white/90 text-indigo-700 text-sm font-bold shadow-brand">I</span>
      <span class="font-semibold text-slate-900">Irisje.nl</span>
    </a>
  </div>
</header>

<main class="max-w-md mx-auto px-4 py-10">
  <h1 class="text-2xl font-semibold mb-2">Account aanmaken</h1>
  <p class="text-slate-600 mb-6">
    Maak eerst een account aan. Daarna kun je je bedrijf registreren en direct aanvragen ontvangen.
  </p>

  <div id="formAlert" class="hidden mb-4 p-4 rounded-2xl bg-rose-50 text-rose-900 text-sm"></div>

  <form id="registerForm" class="space-y-4" novalidate>
    <div class="space-y-1">
      <label class="text-sm font-medium text-slate-800" for="name">Naam</label>
      <input
        id="name"
        type="text"
        name="name"
        required
        class="input"
        placeholder="Bijv. Sander Penning"
        autocomplete="name"
      />
      <p class="text-xs text-slate-500">Gebruik je eigen naam; je bedrijfsprofiel maak je hierna aan.</p>
    </div>

    <div class="space-y-1">
      <label class="text-sm font-medium text-slate-800" for="email">E-mailadres</label>
      <input
        id="email"
        type="email"
        name="email"
        required
        class="input"
        placeholder="E-mailadres"
        autocomplete="email"
      />
    </div>

    <div class="space-y-1">
      <label class="text-sm font-medium text-slate-800" for="password">Wachtwoord</label>
      <input
        id="password"
        type="password"
        name="password"
        required
        class="input"
        placeholder="Minimaal 8 tekens"
        minlength="8"
        autocomplete="new-password"
      />
      <p class="text-xs text-slate-500">Tip: minimaal 8 tekens. Gebruik bij voorkeur een wachtwoordzin.</p>
    </div>

    <button id="submitBtn" type="submit" class="btn-primary w-full">
      Registreren
    </button>
  </form>

  <p class="text-sm text-slate-600 mt-6">
    Heb je al een account?
    <a href="login.html" class="text-indigo-600 hover:underline">Inloggen</a>
  </p>
</main>

<script>
/* frontend/register.html (inline script) */
const API_BASE = "https://irisje-backend.onrender.com/api";

const $form = document.getElementById("registerForm");
const $alert = document.getElementById("formAlert");
const $btn = document.getElementById("submitBtn");

function showAlert(msg) {
  if (!$alert) return alert(msg);
  $alert.textContent = msg;
  $alert.classList.remove("hidden");
}

function clearAlert() {
  if (!$alert) return;
  $alert.textContent = "";
  $alert.classList.add("hidden");
}

function setLoading(isLoading) {
  if (!$btn) return;
  $btn.disabled = isLoading;
  $btn.textContent = isLoading ? "Registreren..." : "Registreren";
}

$form.addEventListener("submit", async (e) => {
  e.preventDefault();
  clearAlert();

  const fd = new FormData($form);
  const name = String(fd.get("name") || "").trim();
  const email = String(fd.get("email") || "").trim();
  const password = String(fd.get("password") || "");

  // Frontend-validatie (matcht backend)
  if (!name || !email || !password) {
    showAlert("Vul alle velden in.");
    return;
  }
  if (password.length < 8) {
    showAlert("Wachtwoord moet minimaal 8 tekens zijn.");
    return;
  }

  setLoading(true);

  try {
    const res = await fetch(`${API_BASE}/auth/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email, password })
    });

    const contentType = res.headers.get("content-type") || "";
    const isJson = contentType.includes("application/json");
    const data = isJson ? await res.json().catch(() => null) : null;

    if (!res.ok) {
      // jouw backend lijkt 'message' te gebruiken
      const msg = data?.error || data?.message || "Registratie mislukt.";
      showAlert(msg);
      return;
    }

    // In jouw huidige flow geeft register geen token terug.
    // Daarom: doorsturen naar login met melding (betrouwbaar & simpel).
    const successMsg = data?.message || "Account aangemaakt. Je kunt nu inloggen.";
    sessionStorage.setItem("registerSuccess", successMsg);
    window.location.href = "login.html";

  } catch (err) {
    console.error("❌ Register fout:", err);
    showAlert("Serverfout bij registreren. Probeer het opnieuw.");
  } finally {
    setLoading(false);
  }
});
</script>

</body>
</html>
