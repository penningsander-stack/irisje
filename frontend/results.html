<!-- frontend/results.html -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Resultaten – Irisje.nl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>

<main class="container mx-auto max-w-5xl py-12">
  <h1 id="results-title" class="text-3xl font-semibold mb-6"></h1>

  <section id="results-list" class="grid gap-6"></section>

  <div id="results-error" class="hidden text-red-600 mt-6"></div>
</main>

<script>
/* ======================================================
   A17.5 – Contextuele results obv company-slug
   ====================================================== */

document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(window.location.search);
  const companySlug = params.get("company");

  // Alleen deze flow aanpassen — geen fallback hier
  if (!companySlug) {
    document.getElementById("results-title").textContent =
      "Algemene resultaten (geen bedrijfscontext)";
    return;
  }

  try {
    const res = await fetch(
      `https://irisje-backend.onrender.com/api/publicRequests/companyContext/${encodeURIComponent(companySlug)}`
    );

    const data = await res.json();

    if (!res.ok || !data.ok) {
      throw new Error(data.message || "Fout bij laden resultaten");
    }

    renderCompanyContext(data);
  } catch (err) {
    console.error(err);
    const el = document.getElementById("results-error");
    el.textContent = err.message;
    el.classList.remove("hidden");
  }
});

function renderCompanyContext(data) {
  const { sourceCompany, matches } = data;

  document.getElementById("results-title").textContent =
    `Vergelijkbare bedrijven voor ${sourceCompany.name}`;

  const list = document.getElementById("results-list");
  list.innerHTML = "";

  matches.forEach(c => {
    const div = document.createElement("div");
    div.className = "border rounded-xl p-6 bg-white shadow-sm";

    div.innerHTML = `
      <h2 class="text-xl font-semibold mb-1">${c.name}</h2>
      <p class="text-gray-600 mb-2">${c.city}</p>
      <p class="text-sm text-gray-500 mb-4">
        ${Array.isArray(c.categories) ? c.categories.join(", ") : ""}
      </p>

      <a
        href="/company.html?slug=${encodeURIComponent(c.slug)}"
        class="inline-block text-indigo-600 hover:underline"
      >
        Bekijk profiel
      </a>
    `;

    list.appendChild(div);
  });
}
</script>

</body>
</html>
