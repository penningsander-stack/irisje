<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Review schrijven – Irisje.nl</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body class="irisje-body">

  <section class="section-shell max-w-xl mx-auto mt-8">
    <h1 id="reviewTitle" class="text-xl font-semibold mb-4">
  Schrijf een review
</h1>


    <form id="reviewForm" class="surface-card p-6 rounded-2xl shadow-soft flex flex-col gap-4">

      <div class="text-sm">
  <span class="block mb-1">Beoordeling</span>

  <div id="starRating" class="flex gap-1 text-2xl cursor-pointer select-none">
    <span data-value="1">★</span>
    <span data-value="2">★</span>
    <span data-value="3">★</span>
    <span data-value="4">★</span>
    <span data-value="5">★</span>
  </div>

  <input type="hidden" name="rating" value="" />
</div>


      <label class="text-sm">
        Jouw review
        <textarea name="comment" required rows="4"
          class="mt-1 w-full border rounded px-2 py-1"></textarea>
      </label>

      <button type="submit"
        class="mt-3 bg-indigo-600 text-white rounded-lg py-2">
        Review verzenden
      </button>

    </form>
  </section>

  <!-- ✅ HIER KOMT DE JS -->
 <script>
(() => {
  const API_BASE = "https://irisje-backend.onrender.com/api";
  const form = document.getElementById("reviewForm");
  if (!form) return;

  const errorBox = document.createElement("div");
  errorBox.className = "text-sm text-red-600";
  form.prepend(errorBox);

  const params = new URLSearchParams(window.location.search);
  const companySlug = params.get("companySlug");

  if (!companySlug) {
    errorBox.textContent = "Ongeldig reviewverzoek.";
    return;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorBox.textContent = "";

    const rating = form.rating.value;
    const comment = form.comment.value.trim();

    // ✅ Frontend-validatie
    if (!rating) {
      errorBox.textContent = "Kies een beoordeling (1–5).";
      return;
    }

    if (!comment) {
      errorBox.textContent = "Schrijf een korte toelichting bij je review.";
      return;
    }

    const payload = { rating, comment, companySlug };

    try {
      const res = await fetch(`${API_BASE}/reviews`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        throw new Error("Submit failed");
      }

      window.location.href = "/review-confirm.html";
    } catch (err) {
      errorBox.textContent =
        "Er ging iets mis bij het verzenden. Probeer het later opnieuw.";
    }
  });
})();
</script>


<script src="/js/review.js?v=20251230"></script>


</body>
</html>
