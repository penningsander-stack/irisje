<!-- frontend/review.html -->
<!-- v20260101-REVIEW-FETCH-FIX -->
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Review plaatsen â€“ Irisje.nl</title>

  <link rel="stylesheet" href="/style.css?v=20251208" />
</head>
<body class="irisje-body">

  <main class="max-w-xl mx-auto px-4 py-8">
    <h1 class="text-2xl font-semibold mb-6">Plaats een review</h1>

    <form id="reviewForm" class="space-y-4">
      <input type="hidden" id="companySlug" />

      <div>
        <label class="block text-sm font-medium mb-1">Naam</label>
        <input id="reviewerName" required class="irisje-input w-full" />
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">E-mail</label>
        <input id="reviewerEmail" type="email" required class="irisje-input w-full" />
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Beoordeling (1â€“5)</label>
        <select id="rating" required class="irisje-input w-full">
          <option value="">Kiesâ€¦</option>
          <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
          <option value="4">â˜…â˜…â˜…â˜…</option>
          <option value="3">â˜…â˜…â˜…</option>
          <option value="2">â˜…â˜…</option>
          <option value="1">â˜…</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">Review</label>
        <textarea id="comment" required rows="5" class="irisje-input w-full"></textarea>
      </div>

      <button
        type="submit"
        class="irisje-btn-primary w-full"
      >
        Review verzenden
      </button>
    </form>

    <p id="reviewStatus" class="mt-4 text-sm"></p>
  </main>

  <script>
    // companySlug uit URL
    const params = new URLSearchParams(window.location.search);
    const slug = params.get("companySlug");
    if (slug) {
      document.getElementById("companySlug").value = slug;
    }

    const form = document.getElementById("reviewForm");
    const statusEl = document.getElementById("reviewStatus");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      statusEl.textContent = "Bezig met verzendenâ€¦";

      const payload = {
        companySlug: document.getElementById("companySlug").value,
        reviewerName: document.getElementById("reviewerName").value.trim(),
        reviewerEmail: document.getElementById("reviewerEmail").value.trim(),
        rating: Number(document.getElementById("rating").value),
        comment: document.getElementById("comment").value.trim(),
      };

      try {
        // ðŸ”§ ENIGE WIJZIGING: juiste endpoint
        const res = await fetch("/api/reviews", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        });

        const data = await res.json();

        if (!res.ok || !data.ok) {
          throw new Error(data.error || "Verzenden mislukt.");
        }

        statusEl.textContent =
          "Dank je wel! Controleer je e-mail om je review te bevestigen.";
        form.reset();
      } catch (err) {
        console.error("[review] submit error:", err);
        statusEl.textContent =
          "Er ging iets mis bij het verzenden. Probeer het later opnieuw.";
      }
    });
  </script>

</body>
</html>
