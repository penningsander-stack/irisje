<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Review schrijven – Irisje.nl</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body class="irisje-body">

  <section class="section-shell max-w-xl mx-auto mt-8">
    <h1 id="reviewTitle" class="text-xl font-semibold mb-4">
      Schrijf een review
    </h1>

    <form id="reviewForm" class="surface-card p-6 rounded-2xl shadow-soft flex flex-col gap-4">

      <!-- Naam -->
      <label class="text-sm">
        Jouw naam
        <input
          type="text"
          name="name"
          required
          class="mt-1 w-full border rounded px-2 py-1"
        />
      </label>

      <!-- E-mail -->
      <label class="text-sm">
        Jouw e-mailadres
        <input
          type="email"
          name="email"
          required
          class="mt-1 w-full border rounded px-2 py-1"
        />
      </label>

      <!-- Rating -->
      <div class="text-sm">
        <span class="block mb-1">Beoordeling</span>

        <div id="starRating" class="flex gap-1 text-2xl cursor-pointer select-none">
          <span data-value="1">★</span>
          <span data-value="2">★</span>
          <span data-value="3">★</span>
          <span data-value="4">★</span>
          <span data-value="5">★</span>
        </div>

        <input type="hidden" name="rating" value="" />
        <div class="mt-1 text-xs text-slate-500">
          Klik op de sterren om te kiezen.
        </div>
      </div>

      <!-- Reviewtekst -->
      <label class="text-sm">
        Jouw review
        <textarea
          name="comment"
          required
          rows="4"
          class="mt-1 w-full border rounded px-2 py-1"
        ></textarea>
      </label>

      <button type="submit" class="mt-3 bg-indigo-600 text-white rounded-lg py-2">
        Review verzenden
      </button>

    </form>
  </section>

  <!-- ⭐ Inline JS: sterren + submit -->
  <script>
  (() => {
    const API_BASE = "https://irisje-backend.onrender.com/api";
    const form = document.getElementById("reviewForm");
    if (!form) return;

    // foutmelding
    const errorBox = document.createElement("div");
    errorBox.className = "text-sm text-red-600 mb-2";
    form.prepend(errorBox);

    const params = new URLSearchParams(window.location.search);
    const companySlug = params.get("companySlug");

    if (!companySlug) {
      errorBox.textContent = "Ongeldig reviewverzoek.";
      return;
    }

    // sterren
    const stars = document.querySelectorAll("#starRating span");
    const ratingInput = form.querySelector('input[name="rating"]');

    function highlight(value) {
      stars.forEach(s => {
        s.style.color =
          Number(s.dataset.value) <= value ? "#f59e0b" : "#cbd5e1";
      });
    }

    highlight(0);

    stars.forEach(star => {
      star.addEventListener("mouseenter", () => {
        highlight(Number(star.dataset.value));
      });
      star.addEventListener("mouseleave", () => {
        highlight(Number(ratingInput.value || 0));
      });
      star.addEventListener("click", () => {
        ratingInput.value = star.dataset.value;
        highlight(Number(star.dataset.value));
        errorBox.textContent = "";
      });
    });

    // submit
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorBox.textContent = "";

      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const rating = ratingInput.value;
      const comment = form.comment.value.trim();

      if (!name || !email || !rating || !comment) {
        errorBox.textContent = "Vul alle velden in.";
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/reviews`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name,
            email,
            rating,
            comment,
            companySlug
          }),
        });

        if (!res.ok) throw new Error();

        window.location.href = "/review-confirm.html";
      } catch {
        errorBox.textContent =
          "Er ging iets mis bij het verzenden. Probeer het later opnieuw.";
      }
    });
  })();
  </script>

</body>
</html>
