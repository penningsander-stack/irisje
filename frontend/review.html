<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Review schrijven – Irisje.nl</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body class="irisje-body">

  <section class="section-shell max-w-xl mx-auto mt-8">
    <h1 class="text-xl font-semibold mb-4">Schrijf een review</h1>

    <form id="reviewForm" class="surface-card p-6 rounded-2xl shadow-soft flex flex-col gap-4">

      <label class="text-sm">
        Beoordeling (1–5)
        <select name="rating" required class="mt-1 w-full border rounded px-2 py-1">
          <option value="">Kies</option>
          <option value="5">5 – Uitstekend</option>
          <option value="4">4 – Goed</option>
          <option value="3">3 – Voldoende</option>
          <option value="2">2 – Matig</option>
          <option value="1">1 – Slecht</option>
        </select>
      </label>

      <label class="text-sm">
        Jouw review
        <textarea name="comment" required rows="4"
          class="mt-1 w-full border rounded px-2 py-1"></textarea>
      </label>

      <button type="submit"
        class="mt-3 bg-indigo-600 text-white rounded-lg py-2">
        Review verzenden
      </button>

    </form>
  </section>

  <!-- ✅ HIER KOMT DE JS -->
  <script>
  (() => {
    const API_BASE = "https://irisje-backend.onrender.com/api";
    const form = document.getElementById("reviewForm");
    if (!form) return;

    const params = new URLSearchParams(window.location.search);
    const companySlug = params.get("companySlug");
    if (!companySlug) {
      window.location.href = "/review-failed.html";
      return;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const payload = {
        rating: form.rating.value,
        comment: form.comment.value,
        companySlug
      };

      try {
        const res = await fetch(`${API_BASE}/reviews`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!res.ok) throw new Error();
        window.location.href = "/review-confirm.html";
      } catch {
        window.location.href = "/review-failed.html";
      }
    });
  })();
  </script>

</body>
</html>
